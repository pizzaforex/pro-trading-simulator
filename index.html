<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Trading Simulator - Elite</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìà</text></svg>">
</head>
<body class="theme-dark">

    <div class="container" id="app-container">
         <header class="main-header">
            <h1>Pro Trading Simulator</h1>
            <div class="controls-bar">
                 <div class="control-group"><label for="assetSelect">Asset:</label><select id="assetSelect" aria-label="Seleziona Asset"></select></div>
                 <div class="control-group"><label for="timeframeSelect">Timeframe:</label><select id="timeframeSelect" aria-label="Seleziona Timeframe"></select></div>
                 <div class="control-group"><button id="themeToggleBtn" title="Cambia Tema" aria-label="Cambia tema chiaro/scuro">‚òÄÔ∏è</button></div>
            </div>
        </header>

        <div class="stats-bar" role="region" aria-label="Statistiche Principali">
            <div class="stat-item"><span class="stat-label">Capitale</span><span class="stat-value" id="capitalDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">Equity</span><span class="stat-value" id="equityDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">P&L Aperto</span><span class="stat-value" id="totalLivePnlDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">P&L Chiuso</span><span class="stat-value" id="totalClosedPnlDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">Win Rate</span><span class="stat-value" id="winRateDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">Max Drawdown</span><span class="stat-value" id="maxDrawdownDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">Disciplina</span><span class="stat-value" id="disciplineDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">Prezzo</span><span class="stat-value" id="priceDisplay">--</span></div>
            <div class="stat-item"><span class="stat-label">ATR (14)</span><span class="stat-value" id="atrDisplay">--</span></div>
        </div>

        <main class="main-layout">
            <section class="chart-section panel" aria-labelledby="chart-heading">
                 <h2 id="chart-heading" class="visually-hidden">Grafico Principale</h2>
                 <!-- Pannello Controlli Grafico (NUOVO) -->
                 <div class="chart-controls">
                    <div class="indicator-control">
                        <input type="checkbox" id="smaToggle" name="smaToggle" checked>
                        <label for="smaToggle">SMA(20)</label>
                    </div>
                     <!-- Aggiungere qui altri controlli indicatori/disegno in futuro -->
                 </div>
                <div id="chartContainer"><div id="chartInfoOverlay" class="chart-info-overlay" aria-live="polite">-- / --</div></div>
                <div class="feedback-area" id="feedback-area" role="log" aria-live="polite"><span id="feedback-text">Inizializzazione...</span></div>
            </section>

            <aside class="side-panel">
                <!-- Pannello Controllo Ordini (Modificato per Modale) -->
                <section class="panel control-panel-trigger" aria-labelledby="order-trigger-heading">
                    <h3 id="order-trigger-heading">Nuovo Ordine</h3>
                    <p class="order-panel-description">Clicca BUY o SELL per aprire il pannello ordine.</p>
                    <div class="button-group main-order-buttons">
                        <button id="triggerBtnBuy" class="buy">BUY</button>
                        <button id="triggerBtnSell" class="sell">SELL</button>
                    </div>
                </section>

                <!-- Pannello Posizioni Aperte -->
                <section class="panel positions-panel" aria-labelledby="positions-heading">
                    <h3 id="positions-heading">Posizioni Aperte (<span id="openPositionsCount">0</span>)</h3>
                    <div class="table-container">
                        <table id="openPositionsTable" aria-live="polite">
                            <thead>
                                <tr>
                                    <th>ID</th><th>Orario</th><th>Tipo</th><th>Volume</th><th>Asset</th>
                                    <th>Entrata</th><th>SL</th><th>TP</th><th>Prezzo</th><th>P&L</th>
                                    <th></th><th></th> <!-- Colonne per Modifica e Chiudi -->
                                </tr>
                            </thead>
                            <tbody><tr class="no-rows-message"><td colspan="12">Nessuna posizione aperta</td></tr></tbody> <!-- Aggiornato colspan -->
                        </table>
                    </div>
                </section>

                 <!-- Pannello Dashboard -->
                <section class="panel dashboard-panel" id="dashboardPanel" aria-labelledby="dashboard-heading">
                    <h3 id="dashboard-heading">Dashboard</h3>
                    <div id="equityChartContainer" role="img" aria-label="Grafico Equity"></div>
                    <div class="dashboard-stats">
                        <div class="dashboard-stat"><span class="stat-label">Trades</span><span class="stat-value" id="totalTradesStat">0</span></div>
                        <div class="dashboard-stat"><span class="stat-label">Profit Factor</span><span class="stat-value" id="profitFactorStat">N/A</span></div>
                    </div>
                </section>

                 <!-- Pannello Storico -->
                <section class="panel history-panel" aria-labelledby="history-heading">
                    <h3 id="history-heading">Storico</h3>
                    <div class="table-container">
                        <table id="historyTable">
                           <thead><tr><th>ID</th><th>Tipo</th><th>Volume</th><th>Asset</th><th>Entrata</th><th>Uscita</th><th>P&L</th><th>Chiusura</th></tr></thead>
                           <tbody><tr class="no-rows-message"><td colspan="8">Nessuna operazione chiusa</td></tr></tbody>
                        </table>
                    </div>
                     <div class="history-buttons">
                         <button id="clearHistoryBtn" class="clear-btn" title="Cancella Storico">Cancella</button>
                         <button id="downloadHistoryBtn" class="download-btn" title="Scarica CSV">Download CSV</button>
                     </div>
                </section>
            </aside>
        </main>
    </div>

    <!-- Modale Ordine (Nascosto) -->
    <div id="orderModal" class="modal-overlay" style="display: none;">
        <div class="modal-content panel">
            <h3 id="orderModalTitle">Nuovo Ordine</h3>
            <button class="modal-close-btn" id="closeOrderModalBtn" aria-label="Chiudi">√ó</button>

            <div class="input-group risk-method-group">
                <label id="modalRiskMethodLabel">Rischio:</label>
                <div class="radio-group" role="radiogroup" aria-labelledby="modalRiskMethodLabel">
                    <input type="radio" id="modalRiskMethodPips" name="modalRiskMethod" value="pips" checked>
                    <label for="modalRiskMethodPips">Pips</label>
                    <input type="radio" id="modalRiskMethodAtr" name="modalRiskMethod" value="atr">
                    <label for="modalRiskMethodAtr">ATR</label>
                </div>
            </div>
            <div class="input-group">
                <label for="modalVolumeInput">Volume (Lots):</label>
                <input type="number" id="modalVolumeInput" value="0.10" min="0.01" step="0.01">
            </div>
            <div class="input-group">
                <label>Size (Unit√†):</label>
                <span id="modalCalculatedUnitsDisplay">--</span>
            </div>
            <div class="input-group" id="modalSlPipsGroup">
                <label for="modalSlPipsInput">SL (Pips):</label>
                <input type="number" id="modalSlPipsInput" value="15" min="1" step="1">
            </div>
            <div class="input-group" id="modalSlAtrGroup" style="display: none;">
                <label for="modalSlAtrMultiInput">SL (ATR x):</label>
                <input type="number" id="modalSlAtrMultiInput" value="1.5" min="0.1" step="0.1">
            </div>
            <div class="input-group" id="modalTpPipsGroup">
                <label for="modalTpPipsInput">TP (Pips):</label>
                <input type="number" id="modalTpPipsInput" value="30" min="1" step="1">
            </div>
            <div class="input-group" id="modalTpAtrGroup" style="display: none;">
                <label for="modalTpAtrMultiInput">TP (ATR x):</label>
                <input type="number" id="modalTpAtrMultiInput" value="3.0" min="0.1" step="0.1">
            </div>
             <div class="input-group">
                <label>Rischio:</label>
                <span id="modalEstimatedRiskDisplay">Calc...</span>
            </div>

            <div class="button-group">
                <button id="executeOrderBtn" class="">Esegui Ordine</button>
                 <button id="cancelOrderBtn" class="cancel-btn">Annulla</button>
            </div>
        </div>
    </div>


    <script src="js/vendor/lightweight-charts.standalone.production.js"></script>
    <script type="module" src="js/main.js"></script>

</body>
</html>
